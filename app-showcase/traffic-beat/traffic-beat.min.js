(function(){var i=PUBNUB,f=i.$,j=i.attr,m=i.each,z=i.publish,A=i.subscribe,B=i.history,C=this.location.href.slice(-400),c=f("traffic-beat"),k={},n=0,q=0,g=[],o=0,D=c&&+j(c,"traffic-beat-striker-speed")||350,u=c&&+j(c,"traffic-beat-striker-width")||25,r=c&&j(c,"traffic-beat-channel"),v=c&&j(c,"traffic-beat-interface")=="on",E=c&&+j(c,"traffic-beat-max-pages")||5;function l(d,h){d&&(d.innerHTML=h)}var w=+new Date,s=w;f("traffic-beat-info");var F=f("traffic-beat-ticker"),G=f("traffic-beat-rpm");f("traffic-beat-start");
var H=f("traffic-beat-last"),I=f("traffic-beat-table"),J=f("traffic-beat-total"),p={d:function(){z({channel:r,message:{page:C,time:+new Date}});if(v&&c){c.style.display="block";A({channel:r},function(d){p.c([d])});B({channel:r,limit:100},function(d){p.c(d);q=o=2})}},c:function(d){var h=[],e=0,t=[];e=e=0;var x=d.length,K=0;s=+new Date;x&&l(H,"Last Visitor: "+(new Date(s)+"").split(" ")[4]);m(d,function(a){var b=a.page;a=a.time;b in k||(k[b]={a:0});o++;n++;q++;k[b].a++;k[b].b=a});l(J,"Latest Visits: "+
n);e=(s-w)/6E4;e=Math.ceil(q/e*1E4)/1E4;l(G,e+"rpm");e=Math.ceil(e*20);F.style.width=(e>300?300:e)+"px";if(x){m(k,function(a,b){t.push({page:a,a:b.a,b:b.b})});t.sort(function(a,b){var y=b.b-a.b;if(!y)return b.a-a.a;return y});m(t,function(a){var b=a.page;a=a.a;++K>E||h.push('<tr><td class="traffic-beat-row">','<div title="',b,'" alt="',b,'">','<a href="',b,'">/',b.split("/").slice(3).join("/").slice(0,25),"</a></div>",'</td><td class="traffic-beat-row-num">',a,'</td><td class="traffic-beat-row-num">',
Math.ceil(a/n*100),"%",'</td><td class="traffic-beat-row-num">','<div class="traffic-beat-graph" style="width:',Math.ceil(a/n*100)*1.4,'px">&nbsp;',"</div>","</td></tr>")});l(I,"<table>"+h.join("")+"</table>")}}};v&&function(){var d=f("traffic-beat-striker");setInterval(function(){if(!g.length){for(var h=[];u>0;u--)h.push(1);m(h,function(){g.push("","")})}g.shift();g.shift();if(Math.ceil(Math.random()*2E3)%10){g.shift();g.push('<div class="traffic-beat-striker-tick"></div>')}if(o){o--;g.push('<div class="traffic-beat-striker-tick"></div>',
'<div class="traffic-beat-striker-tick traffic-beat-striker-tick-on"></div>')}else g.push('<div class="traffic-beat-striker-tick"></div>','<div class="traffic-beat-striker-tick traffic-beat-striker-tick-off"></div>');Math.ceil(Math.random()*2E3)%4||p.c([]);l(d,g.join(""))},D)}();p.d()})();
